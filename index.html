<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–µ—Ç–Ω–∞—è +</title>
</head>
<body>
    <h1 id="auth-name">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>

    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª–µ—Ç–æ–≤ -->
    <ul id="flight-list"></ul>

    <!-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è Telegram -->
    <script>
        function onTelegramAuth(user) {
            const name = user.first_name + (user.last_name ? ' ' + user.last_name : '');
            document.getElementById('auth-name').innerText = '–ü—Ä–∏–≤–µ—Ç, ' + name + '!';
            document.getElementById('flight-form').style.display = 'block';
            renderFlights(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª–µ—Ç—ã
        }
        window.onTelegramAuth = onTelegramAuth;
    </script>

    <!-- Telegram Login –í–ò–î–ñ–ï–¢ -->
    <script async src="https://telegram.org/js/telegram-widget.js?7"
        data-telegram-login="trueletnaya_bot"
        data-size="large"
        data-userpic="false"
        data-request-access="write"
        data-onauth="onTelegramAuth(user)">
    </script>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
    <form id="flight-form" style="display:none; margin-top: 20px;">
        <label>–î–∞—Ç–∞: <input type="date" name="date" required /></label><br />
        <label>–¢–∏–ø –í–°: <input type="text" name="type" required /></label><br />
        <label>–í—Ä–µ–º—è (—á—á:–º–º): <input type="text" name="time" required /></label><br />
        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: <input type="text" name="comment" /></label><br />
        <label>PDF —Ñ–∞–π–ª: <input type="file" name="pdf" accept="application/pdf" /></label><br />
        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>

    <script>
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–ø–∏—Å–µ–π
        let flights = JSON.parse(localStorage.getItem('flights')) || [];

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—ë—Ç–æ–≤
        function renderFlights() {
            const list = document.getElementById('flight-list');
            list.innerHTML = '';
            flights.forEach((f) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    üìÖ <b>${f.date}</b> ‚Äî 
                    ‚úàÔ∏è ${f.type} ‚Äî 
                    ‚è± ${f.time} —á ‚Äî 
                    ${f.comment || ''} 
                    ${f.pdf ? 'üìé ' + f.pdf : ''}
                `;
                list.appendChild(li);
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—ë—Ç–∞
        function addFlight(e) {
            e.preventDefault();
            const form = e.target;
            const date = form.date.value;
            const type = form.type.value;
            const time = form.time.value;
            const comment = form.comment.value;
            const pdf = form.pdf.files[0]?.name || '';

            const newFlight = { date, type, time, comment, pdf };
            flights.push(newFlight);
            localStorage.setItem('flights', JSON.stringify(flights));
            renderFlights();
            form.reset();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('flight-form');
            form.addEventListener('submit', addFlight);
        });
    </script>
</body>
</html>
